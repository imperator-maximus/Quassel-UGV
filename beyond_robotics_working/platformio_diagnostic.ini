; PlatformIO Project Configuration File for PWM Diagnostic Test
;
; Beyond Robotics PWM Diagnostic - Minimal test for Servo.attach() issues
; Tests PA8/PA9 and alternative pins PA6/PA7
;
; USAGE:
; 1. Rename this file to platformio.ini (backup original first)
; 2. Copy pwm_diagnostic_test.cpp to src/main.cpp
; 3. Run: pio run -t upload
; 4. Monitor: pio device monitor -b 115200
;
; EXPECTED RESULTS:
; - Servo.attach() should return true for working pins
; - PWM output should show changing voltages on multimeter
; - Constant 0.62V indicates PWM failure

[env:stm32L431_diagnostic]
platform = ststm32
board = BRMicroNode
framework = arduino
upload_protocol = stlink
debug_tool = stlink
monitor_speed = 115200

; Board configuration
board_build.variants_dir = variants
board_build.ldscript = variants/BRMicroNode/ldscript.ld

; Minimal build flags for diagnostic
build_flags =
    -Wno-error=deprecated-declarations
    -DDIAGNOSTIC_MODE=1

; Only include essential libraries
lib_deps =
    ; No external dependencies - using built-in Servo library

; Diagnostic-specific settings
build_src_filter = 
    +<*>
    -<motor_controller/>
    -<dronecan_handler/>
    -<battery_monitor/>
    -<test/>
    -<config/>

; Debug settings for troubleshooting
debug_build_flags = -O0 -g3 -ggdb

; Upload settings
upload_flags =
    --connect-under-reset

; Monitor settings for real-time debugging
monitor_flags =
    --eol=LF
    --echo
    --filter=time
